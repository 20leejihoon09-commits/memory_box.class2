<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¶”ì–µì˜ ìƒì - 2ë°˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #020617;
      color: #e5e7eb;
    }
    .app-shell {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }
    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: sticky;
        top: 0;
        z-index: 10;
      }
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      padding: 20px;
      border-right: 1px solid rgba(148, 163, 184, 0.2);
    }
    .logo {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }
    .logo-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 20px;
    }
    .nav-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #6b7280;
      margin-top: 16px;
      margin-bottom: 6px;
    }
    .nav-btn {
      width: 100%;
      text-align: left;
      border: none;
      background: transparent;
      color: #e5e7eb;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s, transform 0.08s;
    }
    .nav-btn.active,
    .nav-btn:hover {
      background: rgba(59, 130, 246, 0.18);
      transform: translateY(-1px);
    }

    .stat-card {
      margin-top: 20px;
      padding: 10px 12px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, #1d283a, #020617);
      border: 1px solid rgba(148, 163, 184, 0.2);
      font-size: 12px;
    }
    .stat-label {
      color: #9ca3af;
      font-size: 11px;
      margin-bottom: 2px;
    }
    .stat-value {
      font-size: 18px;
      font-weight: 700;
    }

    /* ë©”ì¸ ì˜ì—­ */
    .main {
      padding: 18px 18px 40px 18px;
      background: radial-gradient(circle at top left, #111827, #020617);
    }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 10px;
    }
    .top-title {
      font-size: 20px;
      font-weight: 700;
    }
    .top-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.14);
      color: #bfdbfe;
    }

    .pill {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e5e7eb;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #3b82f6, #6366f1);
      color: #e5e7eb;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.5);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.1s;
      white-space: nowrap;
    }
    .btn.secondary {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: none;
    }
    .btn.danger {
      background: linear-gradient(135deg, #ef4444, #f97373);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.5);
    }

    .panel {
      border-radius: 18px;
      padding: 18px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.2);
      margin-bottom: 16px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      gap: 8px;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
    }
    .panel-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    .question-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 10px;
    }

    .question-card {
      border-radius: 14px;
      padding: 10px 12px;
      background: radial-gradient(circle at top left, #020617, #0b1120);
      border: 1px solid rgba(75, 85, 99, 0.6);
      font-size: 13px;
    }

    .input {
      width: 100%;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }

    .result-box {
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 420px;
      overflow-y: auto;
    }
  </style>
</head>
<body>

<div class="app-shell">

  <!-- ì‚¬ì´ë“œë°” -->
  <aside class="sidebar">
    <div>
      <div class="logo">ì¶”ì–µì˜ ìƒì</div>
      <div class="logo-sub">2ë°˜ Â· ì¹œêµ¬ ê¸°ì–µ ì €ì¥ì†Œ</div>

      <div class="nav-section-title">ëª¨ë“œ ì„ íƒ</div>
      <button class="nav-btn active" id="nav-participant" onclick="switchView('participant')">ğŸ§‘â€ğŸ“ ì°¸ì—¬ì ëª¨ë“œ</button>
      <button class="nav-btn" id="nav-admin" onclick="switchView('adminLogin')">ğŸ§‘â€ğŸ« ê´€ë¦¬ì ëª¨ë“œ</button>

      <div class="nav-section-title">í˜„ì¬ ìƒíƒœ</div>
      <div class="stat-card">
        <div class="stat-label">ì´ ì œì¶œ ì¸ì›</div>
        <div class="stat-value"><span id="totalVotes">0</span> ëª…</div>
        <div class="stat-label" style="margin-top:6px;">ë°ì´í„°ë² ì´ìŠ¤</div>
        <div style="font-size:11px; color:#9ca3af;">
          memorybox2-79787 <br>
          <span style="color:#60a5fa;">Realtime Database</span> ì—°ê²°
        </div>
      </div>
    </div>
  </aside>

  <!-- ë©”ì¸ -->
  <main class="main">

    <div class="top-bar">
      <div>
        <div class="top-title">2ë°˜ Â· ì¶”ì–µì˜ ìƒì</div>
        <div class="top-sub">1ìœ„(2ì ) / 2ìœ„(1ì ) TOP2 ë°©ì‹</div>
      </div>
    </div>

    <!-- ì°¸ì—¬ì -->
    <section id="view-participant" class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title">ì°¸ì—¬ì ëª¨ë“œ</div>
        </div>
        <button class="btn secondary" onclick="resetParticipantForm()">ì´ˆê¸°í™”</button>
      </div>

      <div id="questions" class="question-grid"></div>

      <button class="btn" onclick="submitVotes()" style="margin-top:12px;">ì œì¶œí•˜ê¸°</button>
    </section>

    <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ -->
    <section id="view-adminLogin" class="panel" style="display:none;">
      <div class="panel-title">ê´€ë¦¬ì ë¡œê·¸ì¸</div>
      <input id="adminPW" type="password" class="input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
      <button class="btn" onclick="checkAdmin()">ë¡œê·¸ì¸</button>
    </section>

    <!-- ê´€ë¦¬ì íŒ¨ë„ -->
    <section id="view-adminPanel" class="panel" style="display:none;">
      <div class="panel-header">
        <div>
          <div class="panel-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ Â· 2ë°˜</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn secondary" onclick="refreshData()">ìƒˆë¡œê³ ì¹¨</button>
          <button class="btn danger" onclick="resetAll()">ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div style="display:grid; grid-template-columns:260px 1fr; gap:14px;">
        <div>
          <div style="margin-bottom:10px;">
            <div class="stat-label">ì´ ì œì¶œ ì¸ì›</div>
            <div style="font-size:22px; font-weight:700;" id="totalVotesAdmin">0</div>
          </div>

          <label class="stat-label">ì§ˆë¬¸ ì„ íƒ</label>
          <select id="graphSelect" class="input"></select>

          <div style="margin-top:10px;">
            <button class="btn secondary" onclick="showQuestionResult()">ì§ˆë¬¸ë³„ ê²°ê³¼</button>
            <button class="btn secondary" onclick="showTotal()">ì „ì²´ í•©ì‚°</button>
          </div>
        </div>

        <div class="result-box" id="resultBox">ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </section>

  </main>
</div>

<!-- Firebase SDK v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  /* ============================
      ğŸ”¥ 2ë°˜ Firebase ì„¤ì •
  =============================*/
  const firebaseConfig = {
    apiKey: "AIzaSyCCeHBvXJYSNQJuYVy57jses_g87wQoNhI",
    authDomain: "memorybox2-79787.firebaseapp.com",
    databaseURL: "https://memorybox2-79787-default-rtdb.firebaseio.com",
    projectId: "memorybox2-79787",
    storageBucket: "memorybox2-79787.firebasestorage.app",
    messagingSenderId: "1047174228260",
    appId: "1:1047174228260:web:9c8dd5fb527ab57101abb1",
    measurementId: "G-RE585WXM2J"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  /* ============================
      ê´€ë¦¬ì ë¹„ë²ˆ (2ë°˜ ì „ìš©)
  =============================*/
  const ADMIN_PASSWORD = "rhalstnrtjstodslatkfkdgkqslek";

  /* ============================
      localStorage í‚¤ë„ ë°˜ë§ˆë‹¤ ë¶„ë¦¬!
  =============================*/
  const KEY_CLIENT = "memoryBox2_clientId_v1";
  const KEY_SUBMITTED = "memoryBox2_submitted_v1";

  const QUESTIONS = [
    "ì²­ì†Œë¥¼ ì—´ì‹¬íˆ í•˜ë˜ ì¹œêµ¬",
    "ë„ì›€ì´ í•„ìš”í•  ë•Œ ê¸°ëŒˆ ìˆ˜ ìˆì—ˆë˜ ì¹œêµ¬",
    "í•™êµ í–‰ì‚¬, ì¼ì • ë“± ì „ë‹¬ ì‚¬í•­ì„ ì˜ ê³µì§€í•´ì£¼ë˜ ì¹œêµ¬",
    "ìˆ˜ì—… ë¶„ìœ„ê¸° ì¡°ì„±ì„ ì˜ ë§ì¶°ì£¼ë˜ ì¹œêµ¬",
    "í˜ë“¤ ë•Œ ì›ƒì„ ìˆ˜ ìˆê²Œ í•´ì£¼ë˜ ì¹œêµ¬",
    "í•™êµ í–‰ì‚¬ì— ì—´ì‹¬íˆ ì°¸ì—¬í•˜ë˜ ì¹œêµ¬",
    "ë¦¬ë”ì‹­, ì¹´ë¦¬ìŠ¤ë§ˆê°€ ë„˜ì¹˜ë˜ ì¹œêµ¬",
    "ë´‰ì‚¬í™œë™ì„ ì—´ì‹¬íˆ í•˜ë˜ ì¹œêµ¬",
    "ì‚¬ì†Œí•œ ì¼ì—ë„ ì•½ì†ì„ ì˜ ì§€í‚¤ë˜ ì¹œêµ¬",
    "ë°”ë¥¸ì–¸ì–´, ë°”ë¥¸ í–‰ë™ ë“± í’ˆì„±ì´ ì•„ë¦„ë‹µë˜ ì¹œêµ¬"
  ];

  let cachedSubmissions = {};

  function switchView(v) {
    document.getElementById("view-participant").style.display = (v === "participant") ? "block" : "none";
    document.getElementById("view-adminLogin").style.display = (v === "adminLogin") ? "block" : "none";
    document.getElementById("view-adminPanel").style.display = (v === "adminPanel") ? "block" : "none";
  }

  function getClientId() {
    let id = localStorage.getItem(KEY_CLIENT);
    if (!id) {
      id = "client_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
      localStorage.setItem(KEY_CLIENT, id);
    }
    return id;
  }

  function buildQuestionForm() {
    const box = document.getElementById("questions");
    box.innerHTML = "";
    QUESTIONS.forEach((q, i) => {
      box.innerHTML += `
        <div class="question-card">
          <div class="question-label">${i+1}. ${q}</div>
          <div class="rank-label">1ìœ„ (2ì )</div>
          <input id="q${i}_1" class="input">
          <div class="rank-label">2ìœ„ (1ì )</div>
          <input id="q${i}_2" class="input">
        </div>
      `;
    });
  }

  function resetParticipantForm() {
    buildQuestionForm();
  }

  function submitVotes() {
    if (localStorage.getItem(KEY_SUBMITTED) === "yes") {
      alert("ì´ë¯¸ ì œì¶œí•œ ê¸°ê¸°ì…ë‹ˆë‹¤.");
      return;
    }

    const clientId = getClientId();
    const submission = {};

    QUESTIONS.forEach((_, qi) => {
      const first = document.getElementById(`q${qi}_1`).value.trim();
      const second = document.getElementById(`q${qi}_2`).value.trim();

      submission[qi] = {};

      if (first) submission[qi][first] = 2;
      if (second && second !== first) submission[qi][second] = 1;
    });

    db.ref("submissions/" + clientId).set(submission).then(() => {
      localStorage.setItem(KEY_SUBMITTED, "yes");
      alert("ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
      refreshData();
      resetParticipantForm();
    });
  }

  function checkAdmin() {
    const pw = document.getElementById("adminPW").value;
    if (pw === ADMIN_PASSWORD) {
      switchView("adminPanel");
      refreshData();
      buildGraphSelector();
    } else {
      alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤");
    }
  }

  function refreshData() {
    db.ref("submissions").once("value").then(snapshot=>{
      cachedSubmissions = snapshot.val() || {};
      const count = Object.keys(cachedSubmissions).length;
      document.getElementById("totalVotes").innerText = count;
      document.getElementById("totalVotesAdmin").innerText = count;
    });
  }

  function buildGraphSelector() {
    const sel = document.getElementById("graphSelect");
    sel.innerHTML = "";
    QUESTIONS.forEach((q, i)=>{
      sel.innerHTML += `<option value="${i}">${i+1}. ${q}</option>`;
    });
  }

  function computeQuestionStats(index) {
    const stats = {};
    Object.values(cachedSubmissions).forEach(sub=>{
      const qData = sub[index];
      if (!qData) return;
      Object.entries(qData).forEach(([name,score])=>{
        if (!stats[name]) stats[name] = 0;
        stats[name] += score;
      });
    });
    return stats;
  }

  function showQuestionResult() {
    const idx = Number(document.getElementById("graphSelect").value);
    const stats = computeQuestionStats(idx);
    const box = document.getElementById("resultBox");

    if (!Object.keys(stats).length) {
      box.textContent = "ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
      return;
    }

    const sorted = Object.entries(stats).sort((a,b)=>b[1]-a[1]);
    let text = `ğŸ“Œ ${idx+1}. ${QUESTIONS[idx]}\n\n`;
    sorted.forEach(([name,score],i)=> text += `${i+1}ìœ„ Â· ${name}: ${score}ì \n`);
    box.textContent = text;
  }

  function showTotal() {
    const total = {};
    Object.values(cachedSubmissions).forEach(sub=>{
      Object.values(sub).forEach(q=>{
        Object.entries(q).forEach(([name,score])=>{
          if (!total[name]) total[name] = 0;
          total[name] += score;
        });
      });
    });

    const box = document.getElementById("resultBox");
    if (!Object.keys(total).length) {
      box.textContent = "ë°ì´í„° ì—†ìŒ";
      return;
    }

    const sorted = Object.entries(total).sort((a,b)=>b[1]-a[1]);
    let text = "ğŸ“Œ ì „ì²´ í•©ì‚°\n\n";
    sorted.forEach(([name,score],i)=> text += `${i+1}ìœ„ Â· ${name}: ${score}ì \n`);
    box.textContent = text;
  }

  function resetAll() {
    if (!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;

    db.ref("submissions").set(null).then(()=>{
      localStorage.removeItem(KEY_CLIENT);
      localStorage.removeItem(KEY_SUBMITTED);
      refreshData();
      alert("ì „ì²´ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ");
    });
  }

  // ì´ˆê¸° ì‹¤í–‰
  window.addEventListener("DOMContentLoaded", () => {
    buildQuestionForm();
    refreshData();
    switchView("participant");
  });
</script>

</body>
</html>
